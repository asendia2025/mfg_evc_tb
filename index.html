<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 1. Title Updated -->
    <title>EVC Test Bench Management</title>
    <!-- 2. Favicon Added -->
    <link rel="icon" type="image/png" href="img/logo_company_transparency.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts: Inter & Noto Sans KR -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', '"Noto Sans KR"', 'sans-serif'], 
                    },
                    colors: {
                        zinc: {
                            50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8', 400: '#a1a1aa',
                            500: '#71717a', 600: '#52525b', 700: '#3f3f46', 800: '#27272a', 900: '#18181b',
                        },
                        brand: {
                            50: '#eff6ff', 500: '#3b82f6', 600: '#2563eb', 900: '#1e3a8a' 
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Load External Equipment Data (Separated as requested) -->
    <script src="evc_equipment_data.js"></script>

    <style>
        body, input, select, button, textarea { font-family: 'Inter', 'Noto Sans KR', sans-serif !important; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #d4d4d8; border-radius: 20px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #a1a1aa; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(228, 228, 231, 0.5);
        }
        
        /* Blueprint Grid Background */
        .blueprint-grid {
            background-color: #f8fafc;
            background-image: 
                linear-gradient(#e2e8f0 1px, transparent 1px),
                linear-gradient(90deg, #e2e8f0 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: -1px -1px;
        }

        /* 3D Bench Card Effect */
        .bench-3d {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.05),
                0 2px 4px -1px rgba(0, 0, 0, 0.03),
                0 0 0 1px rgba(0,0,0,0.05);
        }
        
        .bench-3d:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04),
                0 0 0 1px rgba(59, 130, 246, 0.5);
            z-index: 10;
        }

        .status-dot {
            box-shadow: 0 0 0 2px white;
        }
    </style>
</head>
<body class="bg-zinc-100 min-h-screen flex items-center justify-center p-4 selection:bg-brand-900 selection:text-white overflow-hidden">

    <div class="w-full max-w-[1400px] h-[92vh] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden relative border border-zinc-200">
        
        <!-- Header Bar -->
        <div class="h-14 bg-zinc-50 border-b border-zinc-200 flex items-center justify-between px-6 shrink-0 z-30">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-red-400/80"></div>
                <div class="w-3 h-3 rounded-full bg-amber-400/80"></div>
                <div class="w-3 h-3 rounded-full bg-green-400/80"></div>
            </div>
            
            <div class="flex-1 text-center">
                <span class="text-sm font-bold text-zinc-700 tracking-wide flex items-center justify-center gap-3">
                    <!-- LOGO -->
                    <img src="img/logo_company_transparency.png" alt="EVC Logo" class="h-8 w-auto object-contain">
                    <!-- TEXT -->
                    <span class="flex items-center gap-2">
                        EVC <span class="text-brand-600">TEST BENCH</span> Management
                    </span>
                </span>
            </div>
            
            <div class="w-14 flex justify-end">
                <span class="text-xs text-zinc-400 font-mono">V.4.1</span>
            </div>
        </div>

        <div class="flex flex-1 overflow-hidden">
            
            <!-- Sidebar Navigation -->
            <aside class="w-64 bg-zinc-50/80 border-r border-zinc-200 flex flex-col py-8 px-6 backdrop-blur-sm overflow-y-auto">
                <div class="mb-8">
                    <h2 class="text-xs font-bold text-zinc-400 uppercase tracking-widest mb-4">Operations</h2>
                    <nav class="space-y-1">
                        <button onclick="switchTab('bench-count')" id="nav-bench-count" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg bg-zinc-200 text-zinc-900 text-sm font-medium transition-all text-left group">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 group-hover:text-brand-600"></i> Bench Overview
                        </button>
                        <button onclick="switchTab('equipment')" id="nav-equipment" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900 text-sm font-medium transition-all text-left group">
                            <i data-lucide="settings-2" class="w-4 h-4 group-hover:text-brand-600"></i> Equipment Setup
                        </button>
                        <button onclick="switchTab('test-list')" id="nav-test-list" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900 text-sm font-medium transition-all text-left group">
                            <i data-lucide="list-checks" class="w-4 h-4 group-hover:text-brand-600"></i> Test Protocols
                        </button>
                        <button onclick="switchTab('layout')" id="nav-layout" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900 text-sm font-medium transition-all text-left group">
                            <i data-lucide="map" class="w-4 h-4 group-hover:text-brand-600"></i> Facility Layout
                        </button>
                    </nav>
                </div>

                <div class="mt-auto">
                    <div class="bg-brand-50 rounded-xl p-4 border border-brand-100">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="info" class="w-4 h-4 text-brand-500"></i>
                            <span class="text-xs font-bold text-brand-700">System Status</span>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-[10px] text-brand-600">Assigned Benches</span>
                            <span class="text-xs font-bold text-brand-800">13 / 13</span>
                        </div>
                        <div class="w-full bg-brand-200 h-1.5 rounded-full mt-1">
                            <div class="bg-brand-500 h-1.5 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto bg-zinc-50/50 scroll-smooth p-8 md:p-12 relative">
                
                <!-- 1. Bench Count View -->
                <div id="view-bench-count" class="max-w-6xl mx-auto animate-fade-in">
                    <header class="mb-8 flex justify-between items-end">
                        <div>
                            <span class="text-xs font-bold tracking-widest text-zinc-400 uppercase mb-2 block">Dashboard</span>
                            <h1 class="text-3xl font-bold text-zinc-900 tracking-tight">Bench Configuration by Product</h1>
                            <p class="text-zinc-500 mt-2">Resource allocation for Mass Production.</p>
                        </div>
                        <button class="flex items-center gap-2 text-sm font-medium text-brand-600 hover:text-brand-700">
                            <i data-lucide="download" class="w-4 h-4"></i> Export Report
                        </button>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl border border-zinc-200 shadow-sm flex flex-col justify-between group hover:border-blue-300 transition-all">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                     <div class="text-zinc-500 text-sm font-medium mb-1">Target Products</div>
                                     <div class="text-3xl font-bold text-zinc-900">2 Types</div>
                                </div>
                                <div class="w-12 h-12 rounded-2xl bg-blue-50 flex items-center justify-center text-blue-600 group-hover:bg-blue-100 transition-colors shadow-sm">
                                    <i data-lucide="package" class="w-6 h-6"></i>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] font-bold bg-zinc-100 text-zinc-600 px-2 py-1 rounded">QUANTUM</span>
                                <span class="text-[10px] font-bold bg-zinc-100 text-zinc-600 px-2 py-1 rounded">TYKON</span>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl border border-zinc-200 shadow-sm flex flex-col justify-between group hover:border-zinc-400 transition-all">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                     <div class="text-zinc-500 text-sm font-medium mb-1">Total Capacity</div>
                                     <div class="text-3xl font-bold text-zinc-900">13 Sets</div>
                                </div>
                                <div class="w-12 h-12 rounded-2xl bg-zinc-100 flex items-center justify-center text-zinc-600 group-hover:bg-zinc-200 transition-colors shadow-sm">
                                    <i data-lucide="cpu" class="w-6 h-6"></i>
                                </div>
                            </div>
                            <div class="text-xs text-zinc-500 space-y-1">
                                <div class="flex justify-between"><span>ITB (Initial):</span> <span class="font-bold">4 Sets</span></div>
                                <div class="flex justify-between"><span>FTB (Function):</span> <span class="font-bold">7 Sets</span></div>
                                <div class="flex justify-between"><span>PAT (PA Test):</span> <span class="font-bold text-indigo-600">2 Sets</span></div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl border border-zinc-200 shadow-sm flex flex-col justify-between group hover:border-green-300 transition-all">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                     <div class="text-zinc-500 text-sm font-medium mb-1">System Allocation</div>
                                     <div class="text-3xl font-bold text-zinc-900">100%</div>
                                </div>
                                <div class="w-12 h-12 rounded-2xl bg-green-50 flex items-center justify-center text-green-600 group-hover:bg-green-100 transition-colors shadow-sm">
                                    <i data-lucide="activity" class="w-6 h-6"></i>
                                </div>
                            </div>
                            <div class="text-xs">
                                <span class="flex items-center gap-1 text-zinc-600 font-medium">
                                    <i data-lucide="layers" class="w-3 h-3"></i> 12 Dedicated (Q/T)
                                </span>
                                <span class="flex items-center gap-1 text-amber-600 mt-1 font-medium">
                                    <i data-lucide="shield-alert" class="w-3 h-3"></i> 1 Backup (Shared)
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-zinc-200 shadow-sm overflow-hidden">
                        <div class="px-6 py-4 border-b border-zinc-100 bg-zinc-50/50">
                            <h3 class="font-bold text-zinc-700">Detailed Allocation by Product</h3>
                        </div>
                        <table class="w-full text-sm text-left">
                            <thead class="bg-zinc-50 text-zinc-500 font-bold border-b border-zinc-200">
                                <tr>
                                    <th class="px-6 py-4">Product</th>
                                    <th class="px-6 py-4">Bench Allocation</th>
                                    <th class="px-6 py-4">Bench Qty</th>
                                    <th class="px-6 py-4">Total Qty</th>
                                    <th class="px-6 py-4">Operation Mode</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-zinc-100">
                                <tr class="hover:bg-zinc-50 transition-colors">
                                    <td class="px-6 py-4"><div class="font-bold text-zinc-900 text-base">QUANTUM</div></td>
                                    <td class="px-6 py-4">
                                        <div class="flex flex-col gap-1">
                                            <span class="text-xs font-mono bg-blue-50 text-blue-700 px-2 py-0.5 rounded w-fit">ITB (Initial)</span>
                                            <span class="text-xs font-mono bg-indigo-50 text-indigo-700 px-2 py-0.5 rounded w-fit">FTB (Function)</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4"><div class="flex flex-col gap-1 text-zinc-600"><span>3 sets</span><span>3 sets</span></div></td>
                                    <td class="px-6 py-4 font-bold text-brand-600 text-lg">6</td>
                                    <td class="px-6 py-4 text-zinc-500">Mass Production</td>
                                </tr>
                                <tr class="hover:bg-zinc-50 transition-colors">
                                    <td class="px-6 py-4"><div class="font-bold text-zinc-900 text-base">TYKON</div></td>
                                    <td class="px-6 py-4">
                                        <div class="flex flex-col gap-1">
                                            <span class="text-xs font-mono bg-blue-50 text-blue-700 px-2 py-0.5 rounded w-fit">ITB (Initial)</span>
                                            <span class="text-xs font-mono bg-indigo-50 text-indigo-700 px-2 py-0.5 rounded w-fit">FTB (Function)</span>
                                            <span class="text-xs font-mono bg-purple-50 text-purple-700 px-2 py-0.5 rounded w-fit">PAT (PA Test)</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4"><div class="flex flex-col gap-1 text-zinc-600"><span>1 set</span><span>3 sets</span><span>2 sets</span></div></td>
                                    <td class="px-6 py-4 font-bold text-brand-600 text-lg">6</td>
                                    <td class="px-6 py-4 text-zinc-500">Mass Production</td>
                                </tr>
                                <tr class="hover:bg-zinc-50 transition-colors bg-amber-50/30">
                                    <td class="px-6 py-4"><div class="font-bold text-zinc-700 text-base">Shared (Backup)</div><div class="text-xs text-zinc-500">QUANTUM & TYKON</div></td>
                                    <td class="px-6 py-4"><span class="text-xs font-mono bg-zinc-100 text-zinc-600 px-2 py-0.5 rounded">FTB (Function)</span></td>
                                    <td class="px-6 py-4 text-zinc-600"><span>1 set</span></td>
                                    <td class="px-6 py-4 font-bold text-zinc-700 text-lg">1</td>
                                    <td class="px-6 py-4"><span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-bold bg-amber-100 text-amber-800 border border-amber-200"><i data-lucide="zap" class="w-3 h-3"></i> Peak Support</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 2. Equipment List View (JS Loaded) -->
                <div id="view-equipment" class="max-w-full mx-auto animate-fade-in hidden h-full flex flex-col">
                    <header class="mb-6 shrink-0">
                        <span class="text-xs font-bold tracking-widest text-zinc-400 uppercase mb-2 block">Inventory</span>
                        <h1 class="text-3xl font-bold text-zinc-900 tracking-tight">Set-up Equipment List</h1>
                        <p class="text-zinc-500 mt-2">Required hardware configuration per bench type. (Data Source: evc_equipment_data.js)</p>
                    </header>

                    <div class="flex-1 flex gap-6 overflow-hidden">
                        <div class="w-64 bg-white rounded-xl border border-zinc-200 flex flex-col overflow-hidden shrink-0">
                            <div class="p-4 bg-zinc-50 border-b border-zinc-100 font-bold text-zinc-700 text-sm">Select Bench</div>
                            <div class="overflow-y-auto flex-1 p-2 space-y-1" id="eq-bench-list"></div>
                        </div>

                        <div class="flex-1 bg-white rounded-xl border border-zinc-200 flex flex-col overflow-hidden shadow-sm">
                            <div class="p-4 border-b border-zinc-100 flex justify-between items-center bg-zinc-50/50">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-indigo-100 flex items-center justify-center text-indigo-600" id="eq-bench-icon"><i data-lucide="monitor" class="w-5 h-5"></i></div>
                                    <div>
                                        <h3 class="font-bold text-zinc-900 text-lg" id="eq-bench-title">Select a Bench</h3>
                                        <p class="text-xs text-zinc-500" id="eq-bench-desc">Click on the list to view details</p>
                                    </div>
                                </div>
                                <div class="relative">
                                    <input type="text" placeholder="Search equipment..." class="pl-9 pr-4 py-2 bg-white border border-zinc-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent w-64">
                                    <i data-lucide="search" class="w-4 h-4 text-zinc-400 absolute left-3 top-2.5"></i>
                                </div>
                            </div>
                            
                            <div class="flex-1 overflow-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-zinc-50 text-zinc-500 font-bold border-b border-zinc-200 sticky top-0">
                                        <tr>
                                            <th class="px-6 py-3 w-1/3">Item Name</th>
                                            <th class="px-6 py-3 w-1/3">Model</th>
                                            <th class="px-6 py-3 w-1/3">S/N</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-zinc-100" id="eq-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Test List View -->
                <div id="view-test-list" class="max-w-6xl mx-auto animate-fade-in hidden">
                    <header class="mb-8">
                        <span class="text-xs font-bold tracking-widest text-zinc-400 uppercase mb-2 block">Procedures</span>
                        <h1 class="text-3xl font-bold text-zinc-900 tracking-tight">Test Item List</h1>
                        
                        <div class="flex gap-2 mt-6 border-b border-zinc-200">
                            <button onclick="switchProtocol('quantum')" id="btn-protocol-quantum" class="px-4 py-2 text-sm font-bold text-brand-600 border-b-2 border-brand-600 transition-colors">QUANTUM</button>
                            <button onclick="switchProtocol('tykon')" id="btn-protocol-tykon" class="px-4 py-2 text-sm font-medium text-zinc-500 hover:text-zinc-800 transition-colors border-b-2 border-transparent">TYKON</button>
                        </div>
                    </header>

                    <div class="bg-white rounded-xl border border-zinc-200 shadow-sm overflow-hidden min-h-[500px]">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-zinc-50 text-zinc-500 font-bold border-b border-zinc-200 sticky top-0">
                                <tr>
                                    <th class="px-6 py-4 w-1/4">Bench Type</th>
                                    <th class="px-6 py-4 w-3/4">Test Description</th>
                                </tr>
                            </thead>
                            <tbody id="protocol-quantum" class="divide-y divide-zinc-100">
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 font-bold text-blue-800 border-r border-zinc-200" rowspan="17">Initial Bench (ITB)<br><span class="text-xs font-normal text-blue-600">Step 1 ~ 17</span></td><td class="px-6 py-3 text-zinc-700">1. RS 232 Communication</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">2. Upgrade Firmware</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">3. Linear Power Supply Calibration</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">4. Fan Interlock and Temperature Test</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">5. Check LED</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">6. Front Panel Interlock Test</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">7. Bias Check Test</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">8. Attenuation Test</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">9. Contour Zm Adjustment</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">10. High Frequency S-Map Collection</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">11. High Frequency S-Map Validation</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">12. Low Frequency S-Map Collection</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">13. Low Frequency S-Map Validation</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">14. Generate Caps and Zpar</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">15. DC Bias Calibration</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">16. Low Frequency Phase Map</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 font-bold text-blue-900">17. High Frequency Phase Map</td></tr>
                                
                                <tr class="bg-white"><td class="px-6 py-3 font-bold text-indigo-800 border-r border-zinc-200 border-t border-zinc-200" rowspan="16">Function Bench (FTB)<br><span class="text-xs font-normal text-indigo-600">Step 18 ~ 33</span></td><td class="px-6 py-3 text-zinc-700 border-t border-zinc-200">18. Low Frequency Phase Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">19. High Frequency Phase Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">20. Find Best Tune Position</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">21. High Frequency Voltage Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">22. Low Frequency Voltage Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">23. DAC Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">24. Load Configuration File</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">25. Verify Unit S/N</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">26. Verify Control Board S/N</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">27. VI Sensor Validation</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">28. Auto Match Validation Test</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">29. Preset Validation</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">30. DeviceNet Validation</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">31. Burn-in</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">32. Parameter Validation</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 font-bold text-indigo-900">33. Create Backup file</td></tr>
                            </tbody>
                            
                            <tbody id="protocol-tykon" class="divide-y divide-zinc-100 hidden">
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 font-bold text-blue-800 border-r border-zinc-200" rowspan="20">Initial Bench (ITB)<br><span class="text-xs font-normal text-blue-600">Step 1 ~ 20</span></td><td class="px-6 py-3 text-zinc-700">1. PA TEST</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">2. Preparing Template</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">3. Verify Unit S/N</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">4. Verify Control Board S/N</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">5. RS 232 Communication</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">6. Verify DSP version</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">7. Verify FPGA Firmware</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">8. Upload Default Configuration File</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">9. Verify Temp Sensor Reading</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">10. Interlock Alarm</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">11. Interlock Fan * 3</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">12. Housekeeping voltage calibration</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">13. HVDC Calibration</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">14. Display Board Check</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">15. Bias Current Test</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">16. Cal DC bias voltage</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">17. Perform Contour</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">18. Perform Smap</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 text-zinc-700">19. Smap Validation</td></tr>
                                <tr class="bg-blue-50/50"><td class="px-6 py-3 font-bold text-blue-900">20. Convert to Zpar and Caps files</td></tr>

                                <tr class="bg-white"><td class="px-6 py-3 font-bold text-indigo-800 border-r border-zinc-200 border-t border-zinc-200" rowspan="13">Function Bench (FTB)<br><span class="text-xs font-normal text-indigo-600">Step 21 ~ 33</span></td><td class="px-6 py-3 text-zinc-700 border-t border-zinc-200">21. Phase map</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">22. VI Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">23. VI Validation</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">24. Phase Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">25. Phase Validation</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">26. DAC Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">27. Probe Calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">28. Vpp Vcap calibration</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">29. Parameter validation</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">30. Auto Match Test</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">31. Burn In</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 text-zinc-700">32. Create Backup File</td></tr>
                                <tr class="bg-white"><td class="px-6 py-3 font-bold text-indigo-900">33. Verify DeviceNet or ECAT</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 4. Layout View -->
                <div id="view-layout" class="max-w-6xl mx-auto animate-fade-in hidden">
                    <header class="mb-6 flex justify-between items-end">
                        <div>
                            <span class="text-xs font-bold tracking-widest text-zinc-400 uppercase mb-2 block">Facility Map</span>
                            <h1 class="text-3xl font-bold text-zinc-900 tracking-tight">Test Site Layout</h1>
                        </div>
                        
                        <div class="flex gap-4 p-2 bg-white rounded-lg shadow-sm border border-zinc-200">
                            <div class="flex items-center gap-2 px-2">
                                <span class="relative flex h-3 w-3">
                                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                  <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                                </span>
                                <span class="text-xs font-bold text-zinc-600">Active</span>
                            </div>
                            <div class="h-4 w-px bg-zinc-200"></div>
                            <div class="flex items-center gap-2 text-xs font-medium text-zinc-600">
                                <div class="w-3 h-3 bg-blue-100 border border-blue-500 rounded-sm"></div> QUANTUM
                            </div>
                            <div class="flex items-center gap-2 text-xs font-medium text-zinc-600">
                                <div class="w-3 h-3 bg-indigo-100 border border-indigo-500 rounded-sm"></div> TYKON
                            </div>
                            <div class="flex items-center gap-2 text-xs font-medium text-zinc-600">
                                <div class="w-3 h-3 bg-purple-100 border border-purple-500 rounded-sm"></div> PAT
                            </div>
                            <div class="flex items-center gap-2 text-xs font-medium text-zinc-600">
                                <div class="w-3 h-3 bg-amber-100 border border-amber-500 rounded-sm"></div> Shared
                            </div>
                        </div>
                    </header>

                    <div class="blueprint-grid rounded-xl border-4 border-zinc-700 p-8 shadow-2xl relative h-[900px] w-full max-w-5xl mx-auto flex flex-col overflow-hidden">
                        
                        <!-- Main Lab Floor (Grid) - Moved Up -->
                        <div class="grid grid-cols-3 gap-8 flex-1 px-8 pt-16 relative z-10">
                            <!-- Left Wall (FTB) -->
                            <div class="flex flex-col justify-start gap-4 h-full border-r-2 border-dashed border-zinc-200/50 pr-4">
                                <div class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest mb-2 pl-1">Left Wall (FTB)</div>
                                <div class="w-full h-24 bg-white border-l-4 border-blue-500 rounded-r-lg shadow-sm flex items-center px-4 justify-between bench-3d"><div><div class="text-sm font-bold text-zinc-800">FTB-01</div><div class="text-[9px] text-blue-500 font-bold mt-0.5">QUANTUM</div></div><div class="w-2.5 h-2.5 rounded-full bg-green-500 status-dot"></div></div>
                                <div class="w-full h-24 bg-white border-l-4 border-blue-500 rounded-r-lg shadow-sm flex items-center px-4 justify-between bench-3d"><div><div class="text-sm font-bold text-zinc-800">FTB-02</div><div class="text-[9px] text-blue-500 font-bold mt-0.5">QUANTUM</div></div><div class="w-2.5 h-2.5 rounded-full bg-green-500 status-dot"></div></div>
                                <div class="h-4"></div>
                                <div class="w-full h-24 bg-white border-l-4 border-indigo-500 rounded-r-lg shadow-sm flex items-center px-4 justify-between bench-3d"><div><div class="text-sm font-bold text-zinc-800">FTB-04</div><div class="text-[9px] text-indigo-500 font-bold mt-0.5">TYKON</div></div><div class="w-2.5 h-2.5 rounded-full bg-green-500 status-dot"></div></div>
                                <div class="w-full h-24 bg-white border-l-4 border-indigo-500 rounded-r-lg shadow-sm flex items-center px-4 justify-between bench-3d"><div><div class="text-sm font-bold text-zinc-800">FTB-05</div><div class="text-[9px] text-indigo-500 font-bold mt-0.5">TYKON</div></div><div class="w-2.5 h-2.5 rounded-full bg-green-500 status-dot"></div></div>
                            </div>

                            <!-- Center (ITB) -->
                            <div class="flex flex-col justify-start items-center gap-4 h-full pt-8">
                                <div class="flex items-center gap-2 mb-2"><span class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest">Center ITB Line</span></div>
                                <div class="w-48 h-24 bg-white border-x-4 border-blue-500 rounded-lg shadow-sm flex items-center justify-center relative bench-3d"><div class="flex flex-col items-center"><span class="text-lg font-bold text-zinc-800">ITB-01</span><span class="text-[10px] text-blue-500 font-bold">QUANTUM</span></div></div>
                                <div class="w-48 h-24 bg-white border-x-4 border-blue-500 rounded-lg shadow-sm flex items-center justify-center relative bench-3d"><div class="flex flex-col items-center"><span class="text-lg font-bold text-zinc-800">ITB-02</span><span class="text-[10px] text-blue-500 font-bold">QUANTUM</span></div></div>
                                <div class="w-48 h-24 bg-white border-x-4 border-blue-500 rounded-lg shadow-sm flex items-center justify-center relative bench-3d"><div class="flex flex-col items-center"><span class="text-lg font-bold text-zinc-800">ITB-03</span><span class="text-[10px] text-blue-500 font-bold">QUANTUM</span></div></div>
                                <div class="w-48 h-24 bg-white border-x-4 border-indigo-500 rounded-lg shadow-sm flex items-center justify-center relative bench-3d"><div class="flex flex-col items-center"><span class="text-lg font-bold text-zinc-800">ITB-04</span><span class="text-[10px] text-indigo-500 font-bold">TYKON</span></div></div>
                            </div>

                            <!-- Right Wall (FTB) -->
                            <div class="flex flex-col justify-start gap-4 h-full border-l-2 border-dashed border-zinc-200/50 pl-4">
                                <div class="text-[10px] font-bold text-zinc-400 uppercase tracking-widest mb-2 text-right w-full pr-1">Right Wall (FTB)</div>
                                <div class="w-full h-24 bg-white border-r-4 border-blue-500 rounded-l-lg shadow-sm flex items-center px-4 justify-between bench-3d"><div class="w-2.5 h-2.5 rounded-full bg-green-500 status-dot"></div><div class="text-right"><div class="text-sm font-bold text-zinc-800">FTB-03</div><div class="text-[10px] text-blue-500 font-bold mt-0.5">QUANTUM</div></div></div>
                                <div class="h-4"></div>
                                <div class="w-full h-24 bg-white border-r-4 border-indigo-500 rounded-l-lg shadow-sm flex items-center px-4 justify-between bench-3d"><div class="w-2.5 h-2.5 rounded-full bg-green-500 status-dot"></div><div class="text-right"><div class="text-sm font-bold text-zinc-800">FTB-06</div><div class="text-[10px] text-indigo-500 font-bold mt-0.5">TYKON</div></div></div>
                                <div class="w-full h-24 bg-amber-50 border-2 border-dashed border-amber-400 rounded-lg shadow-none flex items-center px-4 justify-between opacity-90 mt-4"><i data-lucide="layers" class="w-5 h-5 text-amber-500"></i><div class="text-right"><div class="text-sm font-bold text-amber-800">FTB-07</div><div class="text-[10px] text-amber-600 font-bold mt-0.5">SHARED</div></div></div>
                            </div>
                        </div>

                        <!-- Bottom Zone: PAT & Rack (Relocated Here) -->
                        <div class="flex justify-center items-end gap-16 mt-auto pt-6 border-t-2 border-dashed border-zinc-200 pb-12 relative z-10">
                            <div class="flex flex-col items-center gap-2">
                                <span class="text-[10px] font-bold text-purple-600 uppercase tracking-widest bg-purple-50 px-2 py-1 rounded border border-purple-100">PA TEST (Tykon)</span>
                                <div class="flex gap-4">
                                    <div class="w-40 h-24 bg-white border-2 border-purple-400 rounded-xl shadow-lg flex flex-col items-center justify-center relative bench-3d">
                                        <div class="absolute -top-1.5 -right-1.5 w-4 h-4 bg-purple-500 rounded-full border-2 border-white flex items-center justify-center">
                                            <div class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></div>
                                        </div>
                                        <span class="text-sm font-bold text-purple-900">PAT-01</span>
                                        <span class="text-[10px] font-mono text-purple-600 bg-purple-50 px-2 py-0.5 rounded">PA Test</span>
                                    </div>
                                    <div class="w-40 h-24 bg-white border-2 border-purple-400 rounded-xl shadow-lg flex flex-col items-center justify-center relative bench-3d">
                                        <div class="absolute -top-1.5 -right-1.5 w-4 h-4 bg-purple-500 rounded-full border-2 border-white flex items-center justify-center">
                                            <div class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></div>
                                        </div>
                                        <span class="text-sm font-bold text-purple-900">PAT-02</span>
                                        <span class="text-[10px] font-mono text-purple-600 bg-purple-50 px-2 py-0.5 rounded">PA Test</span>
                                    </div>
                                </div>
                            </div>
                            <div class="w-32 h-32 bg-zinc-800 rounded-lg shadow-lg border-t-4 border-zinc-600 flex flex-col items-center justify-center relative group">
                                <i data-lucide="server" class="w-10 h-10 text-zinc-500 mb-1 group-hover:text-zinc-300 transition-colors"></i>
                                <span class="text-[10px] text-zinc-400 font-bold uppercase tracking-widest text-center leading-tight">Main<br>Rack</span>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // 1. Data Processing
        // Group raw data by bench ID for easy access
        // Data is now loaded from evc_equipment_data.js (variable: equipmentData)
        const equipmentDB = {};
        
        // Ensure equipmentData is loaded from evc_equipment_data.js
        if (typeof equipmentData !== 'undefined') {
            equipmentData.forEach(item => {
                if (!equipmentDB[item.bench]) {
                    equipmentDB[item.bench] = [];
                }
                equipmentDB[item.bench].push(item);
            });
        } else {
            console.error("Error: equipmentData is not defined. Make sure evc_equipment_data.js is loaded.");
        }

        function switchTab(tabId) {
            document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="nav-"]').forEach(el => {
                el.classList.remove('bg-zinc-200', 'text-zinc-900');
                el.classList.add('text-zinc-500', 'hover:bg-zinc-100', 'hover:text-zinc-900');
            });

            const view = document.getElementById('view-' + tabId);
            view.classList.remove('hidden');
            view.classList.remove('animate-fade-in');
            void view.offsetWidth;
            view.classList.add('animate-fade-in');
            
            const btn = document.getElementById('nav-' + tabId);
            btn.classList.remove('text-zinc-500', 'hover:bg-zinc-100', 'hover:text-zinc-900');
            btn.classList.add('bg-zinc-200', 'text-zinc-900');

            if(tabId === 'equipment') renderBenchList();
        }

        function switchProtocol(protoId) {
            document.getElementById('protocol-quantum').classList.add('hidden');
            document.getElementById('protocol-tykon').classList.add('hidden');
            ['btn-protocol-quantum', 'btn-protocol-tykon'].forEach(id => {
                document.getElementById(id).className = "px-4 py-2 text-sm font-medium text-zinc-500 hover:text-zinc-800 transition-colors border-b-2 border-transparent";
            });
            document.getElementById('protocol-' + protoId).classList.remove('hidden');
            document.getElementById('btn-protocol-' + protoId).className = "px-4 py-2 text-sm font-bold text-brand-600 border-b-2 border-brand-600 transition-colors";
        }

        function renderBenchList() {
            const container = document.getElementById('eq-bench-list');
            container.innerHTML = '';
            
            const groups = [
                { name: 'Function Bench', prefix: 'FTB', count: 7 },
                { name: 'Initial Bench', prefix: 'ITB', count: 4 },
                { name: 'PA Test Bench', prefix: 'PAT', count: 2 }
            ];

            groups.forEach(g => {
                const groupTitle = document.createElement('div');
                groupTitle.className = "px-3 py-2 text-xs font-bold text-zinc-400 uppercase mt-2";
                groupTitle.innerText = g.name;
                container.appendChild(groupTitle);

                for(let i=1; i<=g.count; i++) {
                    const id = `${g.prefix}-0${i}`;
                    const btn = document.createElement('button');
                    btn.className = "w-full text-left px-3 py-2 rounded-lg text-sm hover:bg-zinc-100 text-zinc-600 transition-colors flex justify-between items-center";
                    btn.innerHTML = `<span>${id}</span> <i data-lucide="chevron-right" class="w-3 h-3 text-zinc-300"></i>`;
                    btn.onclick = () => selectBench(id, btn);
                    container.appendChild(btn);
                }
            });
            
            const firstBtn = container.querySelector('button');
            if(firstBtn) firstBtn.click();
        }

        function selectBench(id, btnElement) {
            document.querySelectorAll('#eq-bench-list button').forEach(b => b.classList.remove('bg-brand-50', 'text-brand-700', 'font-bold'));
            if(btnElement) btnElement.classList.add('bg-brand-50', 'text-brand-700', 'font-bold');

            document.getElementById('eq-bench-title').innerText = id;
            const type = id.startsWith('FTB') ? 'Function Test' : id.startsWith('ITB') ? 'Initial Test' : 'PA Test';
            document.getElementById('eq-bench-desc').innerText = `${type} Configuration`;
            
            const tbody = document.getElementById('eq-table-body');
            tbody.innerHTML = '';
            
            const items = equipmentDB[id] || [];
            if(items.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="px-6 py-8 text-center text-zinc-400">No equipment data available</td></tr>`;
                return;
            }

            items.forEach(item => {
                const row = document.createElement('tr');
                row.className = "hover:bg-zinc-50 transition-colors border-b border-zinc-50";
                row.innerHTML = `
                    <td class="px-6 py-3 font-medium text-zinc-900">${item.name}</td>
                    <td class="px-6 py-3 text-zinc-600 font-mono text-xs">${item.model}</td>
                    <td class="px-6 py-3 text-zinc-500 font-mono text-xs">${item.sn}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>